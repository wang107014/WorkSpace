#体检



##一、个人预约
	zw ^websys.MenuD(51503)
	dhcpepreiadm.main.csp
	dhcpepreiadm.main.hisui.js
	
	1、登记号回车
	    dhcpepreiadm.main.hisui.js中的RegNoOnChange方法中
		赋值
		dhcpepreiadm.main.hisui.js中的SetHisInfo方法中

	2、输入证件号回车是会调用一下方法来根据证件号和科室查找UseID和SetsID

		dhcpepreiadm.main.hisui.js中的FindPreInfoByIDCard方法中
		w ##class(web.DHCPE.NetPre.GetPreInfo).GetInfo("530323198009080031","117")
		
		s ID=$O(^User.DHCPENetPreRecordI("IDCardIndex",IDCard,ID),-1)
		s Status=$LG(^User.DHCPENetPreRecordD(ID),7)
		q:Status'="0"   //Status为0才会有UseID和SetsID
		s UseID=ID
		s SetsID=$LG(^User.DHCPENetPreRecordD(UseID),8)


	3、点预约按钮

		1 、dhcpepreiadm.main.hisui.js中的Save方法中先获取参数(网上预约后未被HIS处理前,参数中会有UseID和SetsID)
	
		2、再调这个##class(web.DHCPE.PreIADM).HISUISave("...")
		在这个方法中会先在个人ADM表(DHC_PE_PreIADM)中新增一条记录信息，产生一个rowid,如果参数中存在UseID和SetsID,则会把网上预约的套餐信息存储在在个人项目表(DHC_PE_PreIOrdItem)中，参数中没有存在UseID和SetsID，则不会存储信息在个人项目表中。
	
		3、个人信息表中有没有信息，则体现在体检项目中有没有信息。

###1、一些选择框

	1、婚姻状况
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindMarried")

	2、体检类别
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindPatFeeType")

	3、VIP等级
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindVIP")

	4、证件类型
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindPAPMICardType")

###2、体检套餐

	d ##class(%ResultSet).RunQuery("web.DHCPE.HandlerOrdSetsEx","queryOrdSet","","ItemSet","","")
	
	1、点击预览
	dhcpepreiadm.main.hisui.js中的openSetWin方法中
	项目信息列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","3350","Ord","","","","","")

	2、双击事件
	onDblClickRow
	


###3、检查列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Item","PreItemList","","")

	1、点击操作
	dhcpepreiadm.main.hisui.js中的AddItem方法中

###4、检验列表

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Lab","PreItemList","","")

###5、其他项目

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Other","PreItemList","","")

###6、药品列表

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Medical","PreItemList","","")

###7、体检项目

	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","11061","PERSON","PRE","Item","ItemSet","","")
	1、点击删除
	dhcpepreiadm.main.hisui.js中的DeleteItemSet方法中


###8、点击预约保存信息

	
	dhcpepreiadm.main.hisui.js中的Save方法中
	1、没有团体信息时
	w ##class("web.DHCPE.PreIADM").HISUISave("","","^9435^^^2018-11-29^2018-11-29^^^PREREG^N^N^N^^N^N^^DC^ID^1^^^^^^^^^0^0^^^^^^N^5$$^","","")
	2、有团体信息时
	w ##class(web.DHCPE.PreIADM).InsertIADMInGTeam()


###9、点击登记

	dhcpepreiadm.main.hisui.js中的Register方法中
	w ##class(web.DHCPE.DHCPEIAdm).UpdateIADMInfo("11069","2",1,"",1)



##二、个人预约查询

###1、点击查询

	DHCPEPreIADM.Find.js中的BFind_click方法中
	d ##class(%ResultSet).RunQuery("web.DHCPE.PreIADM","SearchPreIADM","","","64953","^","","","","","64962","","","","^","","1","")


###2、修改VIP等级

	//体检人员表
	SELECT IADM_CRMADM, * FROM DHC_PE_IADM WHERE IADM_PAADM_DR=69
	//预约个人ADM表(VIP等级)
	SELECT PIADM_Vip, * FROM DHC_PE_PreIADM WHERE PIADM_RowId=10953
	
	DHCPEPreIADM.Find.js中的BUpdateVIPLevel_click方法中
	w ##class(web.DHCPE.PreItemListEx).ChangeVipLevel("69","2")


###3、指引单预览

	DHCPEPreIADM.Find.js中的PatItemPrintXH方法中
	w ##class(web.DHCPE.Query.IAdmItemStatus).GetPatOrdItemInfo("","","69^1^PAADMY","N")

	打印
	DHCPEIAdmItemStatusAdms.PatItemPrint.js中的Print方法中
	xml模板：OEItemPrintA4
	DHCPEIAdmItemStatusAdms.PatItemPrint.js中的PrintA4方法中



###4、报告预览

	DHCPEPreIADM.Find.js中的PreviewAllReport方法中

###5、补打收费条码

	DHCPEPreIADM.Find.js中的PrintPayAagin_Click方法中
	打印
	DHCPEPrintBarCommon.js中的PrintBarRis方法中


###6、修改部门

	//预约个人ADM表
	SELECT PIADM_PIBI_DR, * FROM DHC_PE_PreIADM WHERE PIADM_RowId=11069

	//个人基本信息表(职位)
	SELECT PIBI_Position, * FROM DHC_PE_PreIBaseInfo WHERE PIBI_RowId='9438'
	
	DHCPEPreIADM.Find.js中的BUpdateDepart_click方法中
	w ##class(web.DHCPE.PreIADMEx).UpdateDepartName("11069","吏部")



###7、修改预约项目

	DHCPEPreIADM.Find.js中的BModifyTest_click方法中
	
1、加项界面

	dhcpepreitemlist.main.csp
	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","11075","PERSON","ADD","","ItemSet","","")

	1、确认加项医嘱
	DHCPEPreItemList.js中的ConfirmOrdItem_Click方法中
	
	2、收费弹框
	DHCPEPreItemList.js中的OpenCharge方法中
	dhcpepreauditpay.csp
	结算费用明细
	w ##class(%ResultSet).RunQuery("web.DHCPE.PreAudit","SerchPreAudit","I","","5701","Fee","")
	
	3、审核表对应医嘱明细
	w ##class(%ResultSet).RunQuery("web.DHCPE.ItemFeeList","FindItemFeeList","","","24131","","","","","","","")

2、套餐查询

	d ##class(%ResultSet).RunQuery("web.DHCPE.HandlerOrdSetsEx","queryOrdSet","","ItemSet","11075","PreItemList")


3、医嘱查询(item)

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Item","PreItemList","11075","")

4、医嘱查询(Lab)

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Lab","PreItemList","11075","")



###8、点击收费状态链接

	w ##class(%ResultSet).RunQuery("web.DHCPE.PreAudit","SerchPreAudit","I","11069","","","")

1、项目明细

	w ##class(%ResultSet).RunQuery("web.DHCPE.ItemFeeList","FindItemFeeList","","","24115","","","","","","","")

2、拆分项目

	dhcpe2feelist.csp
	移动选择项
	DHCPEMove.js中的MoveToR_clicked方法中

3、点击打印交款单

	DHCPEPreAudit.List.js中的BPrint_click方法中


###9、点击开始日期

	1、更新日期
	DHCPEUpdateCheckDate.js中的BUpdate_click