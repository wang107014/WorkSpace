#体检



##一、个人预约
	zw ^websys.MenuD(51503)
	dhcpepreiadm.main.csp
	dhcpepreiadm.main.hisui.js
	
	1、登记号回车
	    dhcpepreiadm.main.hisui.js中的RegNoOnChange方法中
		赋值
		dhcpepreiadm.main.hisui.js中的SetHisInfo方法中

	2、输入证件号回车是会调用一下方法来根据证件号和科室查找UseID和SetsID

		dhcpepreiadm.main.hisui.js中的FindPreInfoByIDCard方法中
		w ##class(web.DHCPE.NetPre.GetPreInfo).GetInfo("530323198009080031","117")
		
		s ID=$O(^User.DHCPENetPreRecordI("IDCardIndex",IDCard,ID),-1)
		s Status=$LG(^User.DHCPENetPreRecordD(ID),7)
		q:Status'="0"   //Status为0才会有UseID和SetsID
		s UseID=ID
		s SetsID=$LG(^User.DHCPENetPreRecordD(UseID),8)


	3、点预约按钮

		1 、dhcpepreiadm.main.hisui.js中的Save方法中先获取参数(网上预约后未被HIS处理前,参数中会有UseID和SetsID)
	
		2、再调这个##class(web.DHCPE.PreIADM).HISUISave("...")
		在这个方法中会先在个人ADM表(DHC_PE_PreIADM)中新增一条记录信息，产生一个rowid,如果参数中存在UseID和SetsID,则会把网上预约的套餐信息存储在在个人项目表(DHC_PE_PreIOrdItem)中，参数中没有存在UseID和SetsID，则不会存储信息在个人项目表中。
	
		3、个人信息表中有没有信息，则体现在体检项目中有没有信息。

###1、一些选择框

	1、婚姻状况
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindMarried")

	2、体检类别
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindPatFeeType")

	3、VIP等级
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindVIP")

	4、证件类型
	d ##class(%ResultSet).RunQuery("web.DHCPE.HISUICommon","FindPAPMICardType")

###2、体检套餐

	d ##class(%ResultSet).RunQuery("web.DHCPE.HandlerOrdSetsEx","queryOrdSet","","ItemSet","","")
	
	1、点击预览
	dhcpepreiadm.main.hisui.js中的openSetWin方法中
	项目信息列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","3350","Ord","","","","","")

	2、双击事件
	onDblClickRow
	


###3、检查列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Item","PreItemList","","")

	1、点击操作
	dhcpepreiadm.main.hisui.js中的AddItem方法中

###4、检验列表

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Lab","PreItemList","","")

###5、其他项目

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Other","PreItemList","","")

###6、药品列表

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Medical","PreItemList","","")

###7、体检项目

	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","11061","PERSON","PRE","Item","ItemSet","","")
	1、点击删除
	dhcpepreiadm.main.hisui.js中的DeleteItemSet方法中


###8、点击预约保存信息

	
	dhcpepreiadm.main.hisui.js中的Save方法中
	1、没有团体信息时
	w ##class("web.DHCPE.PreIADM").HISUISave("","","^9435^^^2018-11-29^2018-11-29^^^PREREG^N^N^N^^N^N^^DC^ID^1^^^^^^^^^0^0^^^^^^N^5$$^","","")
	2、有团体信息时
	w ##class(web.DHCPE.PreIADM).InsertIADMInGTeam()


###9、点击登记

	dhcpepreiadm.main.hisui.js中的Register方法中
	w ##class(web.DHCPE.DHCPEIAdm).UpdateIADMInfo("11069","2",1,"",1)



##二、个人预约查询

###1、点击查询

	DHCPEPreIADM.Find.js中的BFind_click方法中
	d ##class(%ResultSet).RunQuery("web.DHCPE.PreIADM","SearchPreIADM","","","64953","^","","","","","64962","","","","^","","1","")


###2、修改VIP等级

	//体检人员表
	SELECT IADM_CRMADM, * FROM DHC_PE_IADM WHERE IADM_PAADM_DR=69
	//预约个人ADM表(VIP等级)
	SELECT PIADM_Vip, * FROM DHC_PE_PreIADM WHERE PIADM_RowId=10953
	
	DHCPEPreIADM.Find.js中的BUpdateVIPLevel_click方法中
	w ##class(web.DHCPE.PreItemListEx).ChangeVipLevel("69","2")


###3、指引单预览

	DHCPEPreIADM.Find.js中的PatItemPrintXH方法中
	w ##class(web.DHCPE.Query.IAdmItemStatus).GetPatOrdItemInfo("","","69^1^PAADMY","N")

	打印
	DHCPEIAdmItemStatusAdms.PatItemPrint.js中的Print方法中
	xml模板：OEItemPrintA4
	DHCPEIAdmItemStatusAdms.PatItemPrint.js中的PrintA4方法中



###4、报告预览

	DHCPEPreIADM.Find.js中的PreviewAllReport方法中

###5、补打收费条码

	DHCPEPreIADM.Find.js中的PrintPayAagin_Click方法中
	打印
	DHCPEPrintBarCommon.js中的PrintBarRis方法中


###6、修改部门

	//预约个人ADM表
	SELECT PIADM_PIBI_DR, * FROM DHC_PE_PreIADM WHERE PIADM_RowId=11069

	//个人基本信息表(职位)
	SELECT PIBI_Position, * FROM DHC_PE_PreIBaseInfo WHERE PIBI_RowId='9438'
	
	DHCPEPreIADM.Find.js中的BUpdateDepart_click方法中
	w ##class(web.DHCPE.PreIADMEx).UpdateDepartName("11069","吏部")



###7、修改预约项目

	DHCPEPreIADM.Find.js中的BModifyTest_click方法中
	
1、加项界面

	dhcpepreitemlist.main.csp
	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","11075","PERSON","ADD","","ItemSet","","")

	1、确认加项医嘱
	DHCPEPreItemList.js中的ConfirmOrdItem_Click方法中
	
	2、收费弹框
	DHCPEPreItemList.js中的OpenCharge方法中
	dhcpepreauditpay.csp
	结算费用明细
	w ##class(%ResultSet).RunQuery("web.DHCPE.PreAudit","SerchPreAudit","I","","5701","Fee","")
	
	3、审核表对应医嘱明细
	w ##class(%ResultSet).RunQuery("web.DHCPE.ItemFeeList","FindItemFeeList","","","24131","","","","","","","")

2、套餐查询

	d ##class(%ResultSet).RunQuery("web.DHCPE.HandlerOrdSetsEx","queryOrdSet","","ItemSet","11075","PreItemList")


3、医嘱查询(item)

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Item","PreItemList","11075","")

4、医嘱查询(Lab)

	d ##class(%ResultSet).RunQuery("web.DHCPE.StationOrder","StationOrderList","","Lab","PreItemList","11075","")



###8、点击收费状态链接

	w ##class(%ResultSet).RunQuery("web.DHCPE.PreAudit","SerchPreAudit","I","11069","","","")

1、项目明细

	w ##class(%ResultSet).RunQuery("web.DHCPE.ItemFeeList","FindItemFeeList","","","24115","","","","","","","")

2、拆分项目

	dhcpe2feelist.csp
	移动选择项
	DHCPEMove.js中的MoveToR_clicked方法中

3、点击打印交款单

	DHCPEPreAudit.List.js中的BPrint_click方法中


###9、点击开始日期

	1、更新日期
	DHCPEUpdateCheckDate.js中的BUpdate_click



##网上预约查询

	1、w ##class(%ResultSet).RunQuery("web.DHCPE.NetPre.PreFind","SerchPreInfo","64983","64989","")



##团体基本信息维护

	w ##class(%ResultSet).RunQuery("web.DHCPE.PreGBaseInfo","SearchPreGBaseInfo","","","","")

1、点击团体编码

	DHCPEPreGBaseInfo.Edit.js中的FindPatDetail方法中



##团体预约

1、团体名称

	w ##class(%ResultSet).RunQuery("web.DHCPE.PreGBaseInfo","SearchGListByDesc","")

2、点击更新

	DHCPEPreGADM.Edit.js中的Update方法中。
	w ##class(web.DHCPE.PreGADM).Save2("","","301^167^2018-12-16^2018-12-19^^^^Y^Y^Y^900^N^N^^DC^IS^ID^^王文正团队自费的体检报告^^^^^^^1^0^^")

3、团体分组

	点击存为预置
	DHCPEPreGTeam.Edit.js中的SaveTemplate方法中
	w ##class("web.DHCPE.PreGTeam","GTeamTempSet","文正分组4^90^67^N^M","","Set")

	点击更新
	DHCPEPreGTeam.Edit.js中的Update_click方法中
	d ##Class(web.DHCPE.PreGTeam).Save2("","","304^^^文正分组4^2018-12-10^2018-12-10^^^N^N^^N^N^^N^90^67^M^1^^^^GD^^^5")


	分组列表信息
	d ##class(%ResultSet).RunQuery("web.DHCPE.PreGTeam","SearchGTeam","304")
	
	复制分组
	DHCPEPreGTeam.List.js中的BCopyTeam_click方法中
	w ##class(web.DHCPE.PreGTeam).CopyTeamData("304||2","")

	快速分组
	DHCPEPreGTeamNew.js中的Update_click方法中
	w ##class(web.DHCPE.PreGTeamNew).Save2("","","304^^^女小于45岁^2018-12-10^2018-12-18^14:09^^N^N^^N^N^^F^45^0^N^2^^6^^GD")

	删除分组
	DHCPEPreGTeamNew.js中的Delete_click方法中
	w ##Class(web.DHCPE.PreGTeam).Delete("","","304||14")

	点击新建人员
	DHCPEPreIADM.Team.js中的BNewIADM方法中
	w ##class(web.DHCPE.PreIADM).InsertIADMInGTeam("9428","292","292||1","")

	选取已预约人员
	查询 zw ##class(%ResultSet).RunQuery("web.DHCPE.SelectPreInfo","SearchPreIADM","020000000044","","304||11")
	新增 w ##class(web.DHCPE.SelectPreInfo).InsertPreToTeam("134||2", 1531)

	点击查询项目列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.Query.PreItemList","QueryPreItemList","11107","PERSON","","","","","")



##团体预约查询

	列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.PreGADM","SearchPreGADM","","王文东团体-测一下","","","","^PREREG^REGISTERED^ARRIVED","","","0","64992","64992","1","","","","")

	点击已检明细
	d ##class(%ResultSet).RunQuery("web.DHCPE.PreGADM","HadCheckedList","359","Y","","","")

	点击起始日期
	d ##class(%ResultSet).RunQuery("web.DHCPE.GAdmRecordManager", "FindGAdmRecord","360")

	点击取消预约(DHC_PE_PreGADM表中的PGADM_Status字段为CANCELPREREG)
	DHCPEPreGADM.Find.js中的BCancelPre方法中
	w ##class(web.DHCPE.PreGADM).UpdateStatus("361","CANCELPREREG")
	再次预约
	w ##class(web.DHCPE.PreGADM).UpdateStatus("366","PREREG")

	点击主场团体
	DHCPEPreGADM.Find.js中的HomeSet_Click方法中
	更新
	w ##class("web.DHCPE.PreHome").UpdateMethod("363^G","","2018-12-09","2018-12-10","30-35","")
	点击时段信息
	d ##class(%ResultSet).RunQuery("web.DHCPE.PreTemplate","SerchTimeInfo","H","3")
	更新时段信息
	DHCPEPreTemplateTime.js的BUpdate方法中
	w ##class(web.DHCPE.PreTemplate).UpdateTimeInfo("H","3","","12:00:00^13:00:00^2^3")
	删除时段信息
	DHCPEPreTemplateTime.js的BDelete_click方法中
	w ##class(web.DHCPE.PreTemplate).DeleteTimeInfo("H","3||2501")

	点击打印人员名单
	DHCPEPreGADM.Find.js中的PrintGroupPerson_Click方法中	



##个人预约信息查询

	zw ##class(%ResultSet).RunQuery("web.DHCPE.Query.IAdmItemStatus", "query","","","64992","","","64992","","")

	点击操作日期
	d ##class(%ResultSet).RunQuery("web.DHCPE.AdmRecordManager", "FindAdmRecord",552)
		
	点击谢绝检查
	DHCPEIAdmItemStatusAdms.js中的Refuse方法中
	w ##class(web.DHCPE.ResultEdit).RefuseCheck("193||4^","")





##退费申请

	w ##class(%ResultSet).RunQuery("web.DHCPE.InvPrt","FindInvPrtList","","","","","64993","64996","","0","","","","")

	点击发票号
	zw ##class(%ResultSet).RunQuery("web.DHCPE.ItemFeeList","FindItemFeeList","","2344","","","","","","","","")

	点击退费单打印
	DHCPEDropItem.js中的BPrint_Click方法中
	w ##class(web.DHCPE.ItemFeeList).GetRefundInfo(2343)

	点击全退审请
	DHCPEDropItem.js中的BRefund_Click方法中
	w ##class("web.DHCPE.Cashier").DropInvPrt()


##客户就餐

	列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.DietManager","SearchIADMDiet","64994","64994","","020000000033","","","")

	点击发饭
	DHCPEDietManager.js中的BSend_click方法中
	DHCPEDietManager.js中的Update方法中
	w ##class(web.DHCPE.DietManager).UpdateDiet("020000000033^","0")

	取消发饭
	DHCPEDietManager.js中的CancelDiet方法中
	w ##class(web.DHCPE.DietManager).CancelDiet("6652","1","1",7058)
	
	登记号回车自动发饭
	DHCPEDietManager.js中的RegNo_KeyDown方法中

	

##赠品管理

	列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.DietManager","SearchIADMGift","64991","64995","","020000000045","0","","")

	点击发送
	DHCPEGiftManager.js中的BSend_click方法中
	w ##class(web.DHCPE.DietManager).UpdateGift("","","")


##允许缴费管理

	w ##class(%ResultSet).RunQuery("web.DHCPE.AllowToCharge","AllowToCharge","","","64994","","","64994","","")

	点击保存
	DHCPEAllowToCharge.js中的Save_Click方法中
	w ##class(web.DHCPE.AllowToCharge).AllowToCharge("6651^1&6693^1&6694^0&6695^0&6696^0&6697^0","Person","ADM")



##收表

	收表结果列表
	d ##class(%ResultSet).RunQuery("web.DHCPE.DHCPEIAdm","SearchGPaperByRecDate","64994","64994","020000000034","","","","","")
	
	在【请确认收表】中录入登记号回车
	DHCPERecPaper.js中的ConfirmRecPaper_KeyDown方法中

	选择送达方式，点击确定
	DHCPEReportDate.js中的BConfirm_click方法中
	w ##class(web.DHCPE.DHCPEIAdm).GetRecPaper("45","2018-12-19","DZB") 
	更新快递地址
	w ##class(web.DHCPE.DHCPEIAdm).UpdateNokAddress("3","www.boe@com.cn")

	勾选【到达未收表】，点击【查询】
	d ##class(%ResultSet).RunQuery("web.DHCPE.DHCPEIAdm","SearchGPaperByRecDate","64994","64994","","on","","","","")

	点击【取消收表】
	DHCPERecPaper.js中的BCancelRecPaper_click方法中
	w ##class(web.DHCPE.DHCPEIAdm).CancelRecPaper("12295")